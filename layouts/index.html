<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">

<head>
  {{ partial "head/metadata.html" . }}
  {{ partial "head/openGraph.html" . }}
  {{ partial "head/favicons.html" . }}
  {{ partial "head/css.html" . }}
  {{ partial "head/custom_head.html" . }}
</head>

<body>
  {{ with .Site.GetPage "/home" }}
  <section id="top" class="hero is-fullheight">
    <!-- Hero head section to play nice with Bulma -->
    <div class="hero-head"></div>

    <!-- Super sweet Hero body title -->
    <div class="hero-body">
      <div class="container has-text-centered">
        <!-- Title and tagline -->
        <h1 class="bold-title fade-in one">
          {{ .Title | markdownify }}
        </h1>
        <div class="subtitle is-3 fade-in two">
          {{ .Content }}
        </div>
        <!-- End title and tagline -->
      </div>
    </div> <!-- End of Hero body -->

    <div class="hero-foot">
      <div class="container">
        <hr>
        <nav class="navbar" role="navigation" aria-label="main navigation">
          <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
          <div class="navbar-menu has-content-centered" id="navMenu">
            <a class="navbar-item" href="/">首页</a>
            <a class="navbar-item" href="/#about">关于</a>
            <a class="navbar-item" href="/#skills">技能</a>
            <a class="navbar-item" href="/#projects">项目</a>
            <a class="navbar-item" href="/#contact">联系</a>
          </div>
        </nav>
        <hr>
      </div>
    </div>
    {{ end }}
  </section> <!-- Done with Hero -->

  {{ with .Site.GetPage "/home" }}
  {{ $home := . }}
  {{ $pages := .Resources.ByType "page" }}

  {{ range sort $pages "Params.weight" }}
  {{ if and (ne .Name "contact.md") (ne .Name "skills.md") }}
  <!-- Range through all sections in /home except contact.md and skills.md -->
  <div class="section" id="{{ .File.TranslationBaseName }}">
    <div class="container">
      <h2 class="title is-2 has-text-centered">{{ .Title | markdownify }}</h2>
      {{ if .Params.Image }}
      <div class="columns">
        <div class="column is-one-third has-text-centered">
          {{ with $home.Resources.GetMatch .Params.Image }}
          {{ with .Resize "320x" }}
          <img class="img-responsive avatar" src="{{ .Permalink }}" alt="{{ .Name }}">
          {{ end }}
          {{ end }}
        </div>
        <div class="markdown column">
          {{ .Content }}
        </div>
      </div>
      {{ else }}
      <div class="markdown has-text-centered">
        {{ .Content }}
      </div>
      {{ end }}
    </div>
    <!-- End container-->
  </div>
  <div class="container">
    <hr>
  </div>
  {{ end }}
  {{ end }}

  <!-- 插入技能部分 -->
  {{ partial "home/skills.html" . }}
  <div class="container">
    <hr>
  </div>

  <!-- 联系部分 -->
  {{ with .Resources.GetMatch "contact.md" }}
  <div class="section" id="{{ .File.TranslationBaseName }}">
    <div class="container has-text-centered">
      <h2 class="title is-2">{{ .Title | markdownify }}</h2>
      <div class="markdown">
        {{ .Content }}
      </div>
      {{ with $.Site.Params.email }}
      <h3 class="subtitle is-3 has-text-centered top-pad">
        <a href="mailto:{{ . }}">{{ . }}</a>
      </h3>
      {{ end }}
    </div>
    <!-- End Contact container -->
  </div>
  {{ end }}
  <!-- End Contact section -->
  {{ end }}

  <footer class="footer">
    <div class="container">
      <div class="content has-text-centered">
        <p>
          © {{ now.Year }} {{ .Site.Title }}
        </p>
      </div>
    </div>
  </footer>

  <!-- 添加导航栏的JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 获取所有的 "navbar-burger" 元素
      const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);

      // 检查是否有 navbar burger
      if ($navbarBurgers.length > 0) {
        // 为每个 navbar burger 添加点击事件
        $navbarBurgers.forEach(el => {
          el.addEventListener('click', () => {
            // 获取目标的 data-target 属性
            const target = el.dataset.target;
            const $target = document.getElementById(target);

            // 切换 "is-active" 类
            el.classList.toggle('is-active');
            $target.classList.toggle('is-active');
          });
        });
      }

      // 滚动触发动画
      const animatedElements = document.querySelectorAll('.animate__animated');

      // 初始化时隐藏所有动画元素
      animatedElements.forEach(el => {
        el.style.opacity = '0';
        el.style.visibility = 'hidden';
      });

      // 检查元素是否在视口中
      function isInViewport(element) {
        const rect = element.getBoundingClientRect();
        return (
          rect.top <= (window.innerHeight || document.documentElement.clientHeight) &&
          rect.bottom >= 0
        );
      }

      // 滚动时检查并触发动画
      function checkAnimations() {
        animatedElements.forEach(el => {
          if (isInViewport(el) && el.style.visibility === 'hidden') {
            el.style.visibility = 'visible';
            el.style.opacity = '1';
            // 保留原始的动画延迟
            const delay = el.style.animationDelay;
            // 移除所有动画类
            el.className = el.className.replace(/\banimate__\S+/g, '');
            // 重新添加动画类
            void el.offsetWidth; // 触发重绘
            el.className += ' ' + el.getAttribute('data-animation');
            if (delay) {
              el.style.animationDelay = delay;
            }
          }
        });
      }

      // 在页面加载时保存原始动画类
      animatedElements.forEach(el => {
        const animationClass = el.className.match(/animate__([a-zA-Z]+)/);
        if (animationClass && animationClass[0]) {
          el.setAttribute('data-animation', animationClass[0]);
        }
      });

      // 监听滚动事件
      window.addEventListener('scroll', checkAnimations);

      // 初始检查
      checkAnimations();

      // 进度条动画
      const progressBars = document.querySelectorAll('.progress-bar');

      function animateProgressBars() {
        progressBars.forEach(bar => {
          const parent = bar.closest('.skill-card');
          if (isInViewport(parent) && bar.style.width === '0px') {
            // 获取设置的宽度
            const targetWidth = bar.getAttribute('style').match(/width:\s*(\d+)%/)[1];
            // 先设置为0
            bar.style.width = '0%';
            // 延迟一下再设置目标宽度，触发动画
            setTimeout(() => {
              bar.style.width = targetWidth + '%';
            }, 100);
          }
        });
      }

      // 监听滚动事件
      window.addEventListener('scroll', animateProgressBars);

      // 初始检查
      animateProgressBars();
    });
  </script>
</body>

</html>